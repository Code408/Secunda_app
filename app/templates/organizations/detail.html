{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        <h1 class="my-4">{{ organization.name }}</h1>
        
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">Контактная информация</h5>
                <p class="card-text">
                    <strong>Телефоны:</strong> {{ organization.phones|join(', ') }}<br>
                    <strong>Адрес:</strong> {{ organization.building.address }}
                </p>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">Виды деятельности</h5>
                <ul class="list-group">
                    {% for activity in organization.activities %}
                    <li class="list-group-item">{{ activity.name }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div id="map" style="width: 100%; height: 400px;"></div>
    </div>
</div>

<script type="application/json" id="org-data">
{
    "name": {{ organization.name|tojson }},
    "building": {
        "address": {{ organization.building.address|tojson }},
        "latitude": {{ organization.building.latitude|tojson }},
        "longitude": {{ organization.building.longitude|tojson }}
    }
}
</script>

<script>
    ymaps.ready(initMap);

    function initMap() {
        const orgData = JSON.parse(document.getElementById('org-data').textContent);
        
        if (!orgData.building || !orgData.building.latitude || !orgData.building.longitude) {
            return;
        }

        const map = new ymaps.Map('map', {
            center: [orgData.building.latitude, orgData.building.longitude],
            zoom: 16
        });

        new ymaps.Placemark(
            [orgData.building.latitude, orgData.building.longitude],
            {
                hintContent: orgData.name,
                balloonContent: `${orgData.name}<br>${orgData.building.address}`
            },
            {
                preset: 'islands#redDotIcon'
            }
        ).addTo(map);
    }
</script>
{% endblock %}
